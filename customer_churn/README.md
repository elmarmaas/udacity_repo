# Predict Customer Churn

- Project **Predict Customer Churn** of ML DevOps Engineer Nanodegree Udacity

## Project Description
The churn_library.py is a library of functions to find customers,
who are likely to churn. 
If run as a whole script, it reads customer data from a csv file 
named bank_data.csv in sub-folder data.
It performs exploratory data analysis (EDA),
encodes categorical variables, performs feature engineering, trains
machine learning models (logistic regression and random forest),
evaluates the models, creates explanability plots using SHAP values
and saves the models to disk.
Processing is completed by providing features importance plots
and ROC curves, for assisting in estimating future customer churn.
Each function is documented with input and output specifications.

## Files and data description
| File / Folder                    | Purpose                                           |
|----------------------------------|---------------------------------------------------|
| README.md                        | This file containing decription of the project    |
| churn_library.py                 | Python library containing the projects functions  |
| churn_script_logging_and_test.py | Test script for all functions in churn_library.py |
| churn_notebook.ipynb             | Concept for the library                           |
| Guide.ipynb                      | Task description by Udacity for this exercise     |
| sequencediagram.jpeg             | Sequence diagram showing the function call hiearchy of the lib | 
| data                             | Folder containing input data bank_data.csv        |
| images                           | Folder containing generated images                |
| logs                             | Folder containing generated logs                  |
| churnenv                         | Folder generated by env setup (see below)         | 

## Running Files
How do you run your files? What should happen when you run your files?
### Environment Setup
Before running  the library code please make sure you have setup the environment
correctly. The library has been developed with python 3.12 and uses several
libraries. It is recommended to setup a virtual environment. This can be done 
in the following way:
Create python virtual environment:
```bash
python3 -m venv churnenv
```
This will create a folder named churnenv. You can now start a virtual environment
by sourcing the activate script from the bin subfolder.
Start virtual environment:

```bash
source churnenv/bin/activate
```
Inside the virtual environment you should install required packages 
as defined in the requirements.txt file: 
```bash
pip install -r requirements.txt
```
Please note that the installtion is only necessary once. After inital 
setup and installation the packages will be available in the virtual 
environment.
Once the environment setup is complete the library code can be executed.

### Running the main library
The main library can be run this way:
```bash
python3 churn_library.py
```
This will execute the churn predition and store generated images in a subfolder
named images. It will also provide logs that can be found in subfolder logs.

The following output will be generated:
| Filename  | Content |
| ----------|---------|
| logs/churn_eda.log | Textual results from exploratory data analysis on input data | 
| logs/churn_library.log | Logging output from the main script - please check  inside this file for warning and errors! | 
| images/feature_correlation_heatmap.png | Heatmap diagram showing the correlation of features in the input dataset | 
| images/roc_curves_comparison.png | ROC curves showing the quality of the two different models used in the lib (Random Forest and Logistic Regression) |
| images/feature_importance.png | Main result showing which feature has most impact on customer churn | 
| images/* | Several other images will be generated in the images folder - these can optionally be used for more detailed insights into the dataset. | 


### Testing the library
Testing the library can be done by running:
```bash
python3 churn_script_logging_and_tests.py
```
